server.port=${APP_PORT:8081}
server.address=${APP_ADDRESS:0.0.0.0}
spring.application.name=ai-chat

bigmodel.base-url=https://open.bigmodel.cn
bigmodel.api-key=${BIGMODEL_API_KEY:}

siliconflow.base-url=${SILICONFLOW_BASE_URL:https://api.siliconflow.cn/v1}
siliconflow.api-key=${SiliconFlow_Api_Key:${SILICONFLOW_API_KEY:}}

app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:5174,http://127.0.0.1:5174,http://47.108.200.227,http://172.19.49.226}
app.cors.allowed-origin-patterns=${CORS_ALLOWED_ORIGIN_PATTERNS:http://localhost:*,http://127.0.0.1:*,http://47.108.200.227:*,http://172.19.49.226:*,http://*.cpolar.cn,https://*.cpolar.cn,http://*.cpolar.top,https://*.cpolar.top,http://*.r9.cpolar.cn,https://*.r9.cpolar.cn,http://*.r6.cpolar.top,https://*.r6.cpolar.top}

chroma.base-url=${CHROMA_BASE_URL:http://127.0.0.1:8000}
chroma.tenant=default_tenant
chroma.database=default_database
chroma.collection-prefix=ollama_chat_doc
siliconflow.embedding-model=${SILICONFLOW_EMBEDDING_MODEL:BAAI/bge-m3}
knowledge.summary-model=${KNOWLEDGE_SUMMARY_MODEL:Auto}

logging.level.com.syh.chat=INFO

management.endpoints.web.exposure.include=health,info,prometheus,metrics
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true
management.metrics.tags.application=${spring.application.name}
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles.http.server.requests=0.95
management.tracing.sampling.probability=${TRACING_SAMPLING_PROBABILITY:0.1}
management.otlp.tracing.endpoint=${OTLP_TRACES_ENDPOINT:http://127.0.0.1:4318/v1/traces}

app.http.client.connect-timeout-ms=${HTTP_CONNECT_TIMEOUT_MS:3000}
app.http.client.response-timeout-ms=${HTTP_RESPONSE_TIMEOUT_MS:20000}
app.http.client.long-response-timeout-ms=${HTTP_LONG_RESPONSE_TIMEOUT_MS:120000}

app.ratelimit.model.limit=${MODEL_RATE_LIMIT:3}
app.ratelimit.model.window-seconds=${MODEL_RATE_WINDOW_SECONDS:1}
app.ratelimit.upload.limit=${UPLOAD_RATE_LIMIT:2}
app.ratelimit.upload.window-seconds=${UPLOAD_RATE_WINDOW_SECONDS:60}

resilience4j.circuitbreaker.instances.bigmodel.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.bigmodel.slidingWindowSize=20
resilience4j.circuitbreaker.instances.bigmodel.minimumNumberOfCalls=10
resilience4j.circuitbreaker.instances.bigmodel.failureRateThreshold=50
resilience4j.circuitbreaker.instances.bigmodel.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.bigmodel.permittedNumberOfCallsInHalfOpenState=3
resilience4j.retry.instances.bigmodel.maxAttempts=2
resilience4j.retry.instances.bigmodel.waitDuration=200ms

resilience4j.circuitbreaker.instances.siliconflow.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.siliconflow.slidingWindowSize=20
resilience4j.circuitbreaker.instances.siliconflow.minimumNumberOfCalls=10
resilience4j.circuitbreaker.instances.siliconflow.failureRateThreshold=50
resilience4j.circuitbreaker.instances.siliconflow.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.siliconflow.permittedNumberOfCallsInHalfOpenState=3
resilience4j.retry.instances.siliconflow.maxAttempts=2
resilience4j.retry.instances.siliconflow.waitDuration=200ms

app.ingest.stream-key=${INGEST_STREAM_KEY:ingest:tasks}
app.ingest.group=${INGEST_STREAM_GROUP:ingest-workers}
app.ingest.queue=${INGEST_QUEUE:redis}
app.ingest.kafka.topic=${INGEST_KAFKA_TOPIC:ingest-tasks}
app.ingest.kafka.group=${INGEST_KAFKA_GROUP:ingest-workers}
app.ingest.kafka.max-attempts=${INGEST_KAFKA_MAX_ATTEMPTS:10}
app.ingest.kafka.retry.base-backoff-ms=${INGEST_KAFKA_RETRY_BASE_BACKOFF_MS:1000}
app.ingest.kafka.retry.max-backoff-ms=${INGEST_KAFKA_RETRY_MAX_BACKOFF_MS:600000}
app.ingest.kafka.publish-batch-size=${INGEST_KAFKA_PUBLISH_BATCH_SIZE:20}
app.ingest.kafka.publish-interval-ms=${INGEST_KAFKA_PUBLISH_INTERVAL_MS:1000}
app.storage.upload-dir=${UPLOAD_DIR:./data/uploads}
app.ingest.redis.max-attempts=${INGEST_REDIS_MAX_ATTEMPTS:10}
app.ingest.redis.retry.base-backoff-ms=${INGEST_REDIS_RETRY_BASE_BACKOFF_MS:1000}
app.ingest.redis.retry.max-backoff-ms=${INGEST_REDIS_RETRY_MAX_BACKOFF_MS:600000}
app.ingest.redis.reclaim-enabled=${INGEST_REDIS_RECLAIM_ENABLED:true}
app.ingest.redis.reclaim-interval-ms=${INGEST_REDIS_RECLAIM_INTERVAL_MS:5000}
app.ingest.redis.reclaim-idle-ms=${INGEST_REDIS_RECLAIM_IDLE_MS:600000}
app.ingest.redis.reclaim-batch-size=${INGEST_REDIS_RECLAIM_BATCH_SIZE:20}
app.ingest.redis.dlq-stream-key=${INGEST_REDIS_DLQ_STREAM_KEY:ingest:tasks:dlq}

spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:}
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.listener.ack-mode=manual

spring.datasource.url=${MYSQL_URL:jdbc:mysql://127.0.0.1:3306/ollama_chat?useSSL=false&serverTimezone=UTC&characterEncoding=utf8}
spring.datasource.username=${MYSQL_USER:root}
spring.datasource.password=${MYSQL_PASSWORD:1234}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000


spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=true

spring.sql.init.mode=never
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true

spring.data.redis.host=${REDIS_HOST:127.0.0.1}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.database=${REDIS_DB:0}
spring.data.redis.timeout=${REDIS_TIMEOUT:3000ms}

jwt.secret=${JWT_SECRET:your-secret-key-must-be-at-least-256-bits-long-for-hs256-please-change-this-in-production}
jwt.expiration=${JWT_EXPIRATION:86400000}
